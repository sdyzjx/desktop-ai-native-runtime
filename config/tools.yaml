version: 1

policy:
  allow:
    - get_time
    - add
    - echo
    - memory_write
    - memory_search
    - workspace.write_file
    - shell.exec
    - persona.update_profile
    - voice.synthesize
  deny: []
  byProvider: {}

exec:
  security: allowlist
  safeBins:
    - echo
    - pwd
    - ls
    - cat
    - grep
  timeoutSec: 20
  maxOutputChars: 8000
  workspaceOnly: true

tools:
  - name: get_time
    type: local
    adapter: builtin.get_time
    description: Get local time.
    input_schema:
      type: object
      properties: {}
      additionalProperties: false

  - name: add
    type: local
    adapter: builtin.add
    description: Add two numbers.
    input_schema:
      type: object
      properties:
        a: { type: number }
        b: { type: number }
      required: [a, b]
      additionalProperties: false

  - name: echo
    type: local
    adapter: builtin.echo
    description: Echo input text.
    input_schema:
      type: object
      properties:
        text: { type: string }
      required: [text]
      additionalProperties: false

  - name: memory_write
    type: local
    adapter: memory.write
    description: Write durable long-term memory entry.
    input_schema:
      type: object
      properties:
        content: { type: string }
        keywords:
          type: array
          items: { type: string }
      required: [content]
      additionalProperties: false

  - name: memory_search
    type: local
    adapter: memory.search
    description: Search long-term memory by keywords.
    input_schema:
      type: object
      properties:
        query: { type: string }
        limit: { type: integer, minimum: 1, maximum: 20 }
      required: [query]
      additionalProperties: false

  - name: workspace.write_file
    type: local
    adapter: fs.write_file
    description: Write content to file under workspace.
    input_schema:
      type: object
      properties:
        path: { type: string }
        content: { type: string }
        mode: { type: string, enum: [overwrite, append] }
      required: [path, content]
      additionalProperties: false

  - name: shell.exec
    type: local
    adapter: shell.exec
    description: Execute safe shell command under workspace.
    input_schema:
      type: object
      properties:
        command: { type: string }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
      required: [command]
      additionalProperties: false

  - name: persona.update_profile
    type: local
    adapter: builtin.persona_update_via_curl
    description: Update global persona profile by calling gateway persona API via curl.
    input_schema:
      type: object
      properties:
        custom_name: { type: string }
      required: [custom_name]
      additionalProperties: false

  - name: voice.synthesize
    type: local
    adapter: voice.synthesize
    description: >
      Synthesize text to speech using Qwen3-TTS and return a local ogg audio file path.
      Requires DASHSCOPE_API_KEY, python3, and ffmpeg.
      Use when the user asks for a voice reply or audio output.
    input_schema:
      type: object
      properties:
        text:
          type: string
          description: Text to synthesize (required)
        voice_tag:
          type: string
          enum: [jp, zh, en]
          description: "Language tag: jp=Japanese, zh=Chinese, en=English (default: zh)"
        model:
          type: string
          description: TTS model override (optional)
        voice:
          type: string
          description: Voice ID override (optional)
      required: [text]
      additionalProperties: false
