version: 1

policy:
  allow:
    - get_time
    - add
    - echo
    - memory_write
    - memory_search
    - workspace.write_file
    - shell.exec
    - persona.update_profile
    - voice.tts_aliyun_vc
    - voice.asr_aliyun
    - voice.stats
    - live2d.param.set
    - live2d.param.batch_set
    - live2d.motion.play
    - live2d.expression.set
    - live2d.emote
    - live2d.gesture
    - live2d.react
  deny: []
  byProvider: {}

exec:
  security: allowlist
  safeBins:
    - echo
    - pwd
    - ls
    - cat
    - grep
  timeoutSec: 20
  maxOutputChars: 8000
  workspaceOnly: true

tools:
  - name: get_time
    type: local
    adapter: builtin.get_time
    description: Get local time.
    input_schema:
      type: object
      properties: {}
      additionalProperties: false

  - name: add
    type: local
    adapter: builtin.add
    description: Add two numbers.
    input_schema:
      type: object
      properties:
        a: { type: number }
        b: { type: number }
      required: [a, b]
      additionalProperties: false

  - name: echo
    type: local
    adapter: builtin.echo
    description: Echo input text.
    input_schema:
      type: object
      properties:
        text: { type: string }
      required: [text]
      additionalProperties: false

  - name: memory_write
    type: local
    adapter: memory.write
    description: Write durable long-term memory entry.
    input_schema:
      type: object
      properties:
        content: { type: string }
        keywords:
          type: array
          items: { type: string }
      required: [content]
      additionalProperties: false

  - name: memory_search
    type: local
    adapter: memory.search
    description: Search long-term memory by keywords.
    input_schema:
      type: object
      properties:
        query: { type: string }
        limit: { type: integer, minimum: 1, maximum: 20 }
      required: [query]
      additionalProperties: false

  - name: workspace.write_file
    type: local
    adapter: fs.write_file
    description: Write content to file under workspace.
    input_schema:
      type: object
      properties:
        path: { type: string }
        content: { type: string }
        mode: { type: string, enum: [overwrite, append] }
      required: [path, content]
      additionalProperties: false

  - name: shell.exec
    type: local
    adapter: shell.exec
    description: Execute safe shell command under workspace.
    input_schema:
      type: object
      properties:
        command: { type: string }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
      required: [command]
      additionalProperties: false

  - name: persona.update_profile
    type: local
    adapter: builtin.persona_update_via_curl
    description: Update global persona profile by calling gateway persona API via curl.
    input_schema:
      type: object
      properties:
        custom_name: { type: string }
      required: [custom_name]
      additionalProperties: false

  - name: voice.tts_aliyun_vc
    type: local
    adapter: voice.tts_aliyun_vc
    description: >
      Generate speech audio via Qwen3-TTS-VC (Aliyun DashScope).
      Only provide text and voiceTag. Model and voice are managed by the qwen3_tts provider config and must NOT be passed.
    input_schema:
      type: object
      properties:
        text: { type: string }
        voiceTag: { type: string, enum: [zh, jp, en] }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
        turnId: { type: string }
        idempotencyKey: { type: string }
        replyMeta:
          type: object
          properties:
            inputType: { type: string, enum: [text, audio] }
            sentenceCount: { type: integer, minimum: 1 }
            containsCode: { type: boolean }
            containsTable: { type: boolean }
            containsManyLinks: { type: boolean }
            isTroubleshooting: { type: boolean }
          additionalProperties: false
      required: [text]
      additionalProperties: false

  - name: voice.asr_aliyun
    type: local
    adapter: voice.asr_aliyun
    description: Transcribe audio to text with Aliyun ASR and feed into session loop.
    input_schema:
      type: object
      properties:
        audioRef: { type: string }
        format: { type: string, enum: [wav, mp3, ogg, webm, m4a] }
        lang: { type: string, enum: [zh, en, auto] }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
        hints:
          type: array
          items: { type: string }
      required: [audioRef, format]
      additionalProperties: false

  - name: voice.stats
    type: local
    adapter: voice.stats
    description: Return in-memory voice pipeline metrics snapshot.
    input_schema:
      type: object
      properties: {}
      additionalProperties: false

  - name: live2d.param.set
    type: local
    adapter: live2d.param.set
    description: Set one Live2D model parameter by name.
    input_schema:
      type: object
      properties:
        name: { type: string, minLength: 1, maxLength: 128 }
        value: { type: number }
      required: [name, value]
      additionalProperties: false

  - name: live2d.param.batch_set
    type: local
    adapter: live2d.param.batch_set
    description: Set multiple Live2D model parameters in one call.
    input_schema:
      type: object
      properties:
        updates:
          type: array
          minItems: 1
          maxItems: 60
          items:
            type: object
            properties:
              name: { type: string, minLength: 1, maxLength: 128 }
              value: { type: number }
            required: [name, value]
            additionalProperties: false
      required: [updates]
      additionalProperties: false

  - name: live2d.motion.play
    type: local
    adapter: live2d.motion.play
    description: Play one Live2D motion group/index.
    input_schema:
      type: object
      properties:
        group: { type: string, minLength: 1, maxLength: 128 }
        index: { type: integer, minimum: 0, maximum: 1024 }
        action_id: { type: string, minLength: 1, maxLength: 160 }
        duration_sec: { type: number, exclusiveMinimum: 0, maximum: 120 }
        queue_policy: { type: string, enum: [append, replace, interrupt] }
      required: [group]
      additionalProperties: false

  - name: live2d.expression.set
    type: local
    adapter: live2d.expression.set
    description: Set one Live2D expression by name.
    input_schema:
      type: object
      properties:
        name: { type: string, minLength: 1, maxLength: 128 }
        action_id: { type: string, minLength: 1, maxLength: 160 }
        duration_sec: { type: number, exclusiveMinimum: 0, maximum: 120 }
        queue_policy: { type: string, enum: [append, replace, interrupt] }
      required: [name]
      additionalProperties: false

  - name: live2d.emote
    type: local
    adapter: live2d.emote
    description: Trigger semantic emotion preset and map to expression/parameters.
    input_schema:
      type: object
      properties:
        emotion: { type: string, minLength: 1, maxLength: 64 }
        intensity: { type: string, enum: [low, medium, high] }
        timeoutMs: { type: integer, minimum: 500, maximum: 120000 }
      required: [emotion]
      additionalProperties: false

  - name: live2d.gesture
    type: local
    adapter: live2d.gesture
    description: Trigger semantic gesture preset and map to motion/expression.
    input_schema:
      type: object
      properties:
        type: { type: string, minLength: 1, maxLength: 64 }
        timeoutMs: { type: integer, minimum: 500, maximum: 120000 }
      required: [type]
      additionalProperties: false

  - name: live2d.react
    type: local
    adapter: live2d.react
    description: Trigger semantic reaction preset sequence.
    input_schema:
      type: object
      properties:
        intent: { type: string, minLength: 1, maxLength: 64 }
        timeoutMs: { type: integer, minimum: 500, maximum: 120000 }
      required: [intent]
      additionalProperties: false
