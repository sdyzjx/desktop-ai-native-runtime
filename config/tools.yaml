version: 1

policy:
  allow:
    - get_time
    - add
    - echo
    - memory_write
    - memory_search
    - workspace.write_file
    - shell.exec
    - persona.update_profile
    - voice.tts_aliyun_vc
    - voice.asr_aliyun
    - voice.stats
  deny: []
  byProvider: {}

exec:
  security: allowlist
  safeBins:
    - echo
    - pwd
    - ls
    - cat
    - grep
  timeoutSec: 20
  maxOutputChars: 8000
  workspaceOnly: true

tools:
  - name: get_time
    type: local
    adapter: builtin.get_time
    description: Get local time.
    input_schema:
      type: object
      properties: {}
      additionalProperties: false

  - name: add
    type: local
    adapter: builtin.add
    description: Add two numbers.
    input_schema:
      type: object
      properties:
        a: { type: number }
        b: { type: number }
      required: [a, b]
      additionalProperties: false

  - name: echo
    type: local
    adapter: builtin.echo
    description: Echo input text.
    input_schema:
      type: object
      properties:
        text: { type: string }
      required: [text]
      additionalProperties: false

  - name: memory_write
    type: local
    adapter: memory.write
    description: Write durable long-term memory entry.
    input_schema:
      type: object
      properties:
        content: { type: string }
        keywords:
          type: array
          items: { type: string }
      required: [content]
      additionalProperties: false

  - name: memory_search
    type: local
    adapter: memory.search
    description: Search long-term memory by keywords.
    input_schema:
      type: object
      properties:
        query: { type: string }
        limit: { type: integer, minimum: 1, maximum: 20 }
      required: [query]
      additionalProperties: false

  - name: workspace.write_file
    type: local
    adapter: fs.write_file
    description: Write content to file under workspace.
    input_schema:
      type: object
      properties:
        path: { type: string }
        content: { type: string }
        mode: { type: string, enum: [overwrite, append] }
      required: [path, content]
      additionalProperties: false

  - name: shell.exec
    type: local
    adapter: shell.exec
    description: Execute safe shell command under workspace.
    input_schema:
      type: object
      properties:
        command: { type: string }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
      required: [command]
      additionalProperties: false

  - name: persona.update_profile
    type: local
    adapter: builtin.persona_update_via_curl
    description: Update global persona profile by calling gateway persona API via curl.
    input_schema:
      type: object
      properties:
        custom_name: { type: string }
      required: [custom_name]
      additionalProperties: false

  - name: voice.tts_aliyun_vc
    type: local
    adapter: voice.tts_aliyun_vc
    description: Generate speech audio by Qwen3-TTS-VC (Aliyun DashScope) with policy + cooldown control.
    input_schema:
      type: object
      properties:
        text: { type: string }
        voiceId: { type: string }
        model: { type: string }
        voiceTag: { type: string, enum: [zh, jp, en] }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
        turnId: { type: string }
        idempotencyKey: { type: string }
        replyMeta:
          type: object
          properties:
            inputType: { type: string, enum: [text, audio] }
            sentenceCount: { type: integer, minimum: 1 }
            containsCode: { type: boolean }
            containsTable: { type: boolean }
            containsManyLinks: { type: boolean }
            isTroubleshooting: { type: boolean }
          additionalProperties: false
      required: [text, voiceId, model]
      additionalProperties: false

  - name: voice.asr_aliyun
    type: local
    adapter: voice.asr_aliyun
    description: Transcribe audio to text with Aliyun ASR and feed into session loop.
    input_schema:
      type: object
      properties:
        audioRef: { type: string }
        format: { type: string, enum: [wav, mp3, ogg, webm, m4a] }
        lang: { type: string, enum: [zh, en, auto] }
        timeoutSec: { type: integer, minimum: 1, maximum: 120 }
        hints:
          type: array
          items: { type: string }
      required: [audioRef, format]
      additionalProperties: false

  - name: voice.stats
    type: local
    adapter: voice.stats
    description: Return in-memory voice pipeline metrics snapshot.
    input_schema:
      type: object
      properties: {}
      additionalProperties: false
