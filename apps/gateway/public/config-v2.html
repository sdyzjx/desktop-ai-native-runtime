<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Config v2 — Yachiyo</title>
  <link rel="stylesheet" href="/system.css" />
  <link rel="stylesheet" href="/config-v2.css" />
</head>
<body>
  <div class="cv2-shell">

    <!-- ── Header ── -->
    <header class="cv2-header" role="banner">
      <div class="cv2-header-left">
        <h1 class="cv2-title">Config v2</h1>
        <p class="cv2-subtitle">编辑所有配置文件，保存后新会话立即生效。</p>
      </div>
      <div class="cv2-header-actions">
        <label class="theme-control" for="themeSelect">
          <span>Theme</span>
          <select id="themeSelect" aria-label="切换主题">
            <option value="auto">auto</option>
            <option value="light">light</option>
            <option value="dark">dark</option>
          </select>
        </label>
        <a class="btn" href="/">Back to Chat</a>
        <a class="btn" href="/config.html">Providers (v1)</a>
      </div>
    </header>

    <!-- ── Tab bar ── -->
    <nav class="cv2-tabbar" role="tablist" aria-label="配置文件选择">
      <!-- tabs injected by JS -->
    </nav>

    <!-- ── Main layout ── -->
    <div class="cv2-main">

      <!-- Editor pane -->
      <section class="cv2-editor-pane panel" aria-label="YAML 编辑器">
        <div class="cv2-editor-toolbar">
          <span id="cv2-file-label" class="cv2-file-label" aria-live="polite"></span>
          <span id="cv2-readonly-badge" class="cv2-readonly-badge" aria-label="只读文件" hidden>只读</span>
          <div class="cv2-toolbar-actions">
            <button class="btn" id="loadBtn" type="button">重新加载</button>
            <button class="btn btn-primary" id="saveBtn" type="button">保存</button>
          </div>
        </div>

        <div class="cv2-editor-wrap">
          <textarea
            id="editor"
            class="cv2-editor"
            spellcheck="false"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            aria-label="YAML 编辑器"
            aria-describedby="cv2-status"
            placeholder="loading..."
          ></textarea>
        </div>

        <div class="cv2-editor-footer">
          <span id="cv2-status" class="status" role="status" aria-live="polite"></span>
        </div>

        <!-- Git log panel -->
        <section class="cv2-git-panel" aria-label="版本历史">
          <div class="cv2-git-header">
            <span class="cv2-git-title">版本历史</span>
            <span id="cv2-dirty-badge" class="cv2-dirty-badge" hidden aria-label="有未提交的改动">● 未提交</span>
            <div class="cv2-git-pagination" role="group" aria-label="版本历史翻页">
              <button class="btn cv2-git-page-btn" id="gitPrevBtn" type="button" aria-label="上一页" disabled>‹</button>
              <span id="gitPageInfo" class="cv2-git-page-info" aria-live="polite">1 / 1</span>
              <button class="btn cv2-git-page-btn" id="gitNextBtn" type="button" aria-label="下一页" disabled>›</button>
            </div>
            <button class="btn cv2-git-refresh" id="gitRefreshBtn" type="button" aria-label="刷新版本历史">↻</button>
          </div>
          <ol id="cv2-git-log" class="cv2-git-log" aria-label="提交记录列表"></ol>
        </section>
      </section>

      <!-- Agent pane -->
      <aside class="cv2-agent-pane panel" aria-label="Agent 对话">
        <div class="cv2-agent-header">
          <span class="cv2-agent-title">Agent 对话</span>
          <span class="cv2-agent-hint">当前文件内容自动注入为上下文</span>
        </div>

        <div
          id="agentMessages"
          class="cv2-agent-messages"
          role="log"
          aria-live="polite"
          aria-label="对话记录"
          aria-relevant="additions"
        ></div>

        <div class="cv2-agent-input-row">
          <label for="agentInput" class="sr-only">向 Agent 提问</label>
          <input
            id="agentInput"
            type="text"
            class="cv2-agent-input"
            placeholder="问 agent 如何修改配置…"
            aria-label="向 Agent 提问"
            autocomplete="off"
          />
          <button class="btn btn-primary" id="agentSendBtn" type="button" aria-label="发送消息">发送</button>
        </div>
      </aside>

    </div><!-- /.cv2-main -->

    <!-- ── Desktop Bubble Settings ── -->
    <section class="cv2-section panel" aria-label="桌面气泡设置" style="margin: 20px; padding: 20px;">
      <h2 style="margin-top: 0; font-size: 16px; font-weight: 600;">桌面气泡设置</h2>

      <div style="display: grid; gap: 16px;">
        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="bubbleTruncateEnabled" />
          <span>启用消息截断</span>
        </label>

        <div style="display: grid; gap: 8px;">
          <label for="bubbleMaxLength" style="font-size: 14px;">最大字符数</label>
          <input
            type="number"
            id="bubbleMaxLength"
            min="50"
            max="500"
            value="120"
            style="padding: 6px 8px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); color: var(--text);"
          />
          <p style="font-size: 12px; color: var(--muted); margin: 0;">
            当消息超过设定字符数时，气泡将只显示前N个字符
          </p>
        </div>

        <div style="display: grid; gap: 8px;">
          <label for="bubbleTruncateMode" style="font-size: 14px;">截断模式</label>
          <select
            id="bubbleTruncateMode"
            style="padding: 6px 8px; border: 1px solid var(--line); border-radius: 6px; background: var(--panel); color: var(--text);"
          >
            <option value="simple">简单模式</option>
            <option value="smart" selected>智能模式（推荐）</option>
            <option value="disabled">禁用</option>
          </select>
          <p style="font-size: 12px; color: var(--muted); margin: 0;">
            智能模式会保持单词边界和公式完整性
          </p>
        </div>

        <label style="display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="bubbleShowHintForComplex" checked />
          <span>复杂内容显示提示</span>
        </label>
        <p style="font-size: 12px; color: var(--muted); margin: 0 0 0 28px;">
          当消息包含图表或公式时，显示提示而非截断
        </p>

        <button
          id="saveBubbleConfig"
          class="btn btn-primary"
          type="button"
          style="width: fit-content;"
        >
          保存气泡配置
        </button>
        <div id="bubbleConfigHint" style="font-size: 12px; color: var(--muted);"></div>
      </div>
    </section>

  </div><!-- /.cv2-shell -->

  <script src="/config-v2.js"></script>
</body>
</html>
